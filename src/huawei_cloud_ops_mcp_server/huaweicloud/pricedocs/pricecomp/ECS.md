# ECS 价格数据结构说明文档

本文档用于说明华为云 ECS（弹性云服务器）价格数据的 JSON 结构，帮助 MCP 工具正确理解和解析价格信息。

## 数据结构概览

ECS 价格数据采用 JSON 格式存储，每条记录代表一个特定配置组合的价格信息。数据结构如下：

```json
{
  "region": "区域名称",
  "zone": "可用区名称",
  "cpu_arch": "CPU架构类型",
  "spec1": "规格类型1（大类）",
  "spec2": "规格类型2（具体型号）",
  "image": "镜像类型",
  "price_table": {
    "headers": ["表头数组"],
    "data": [["数据行数组"]]
  },
  "created_at": "创建时间（ISO 8601格式）"
}
```

## 字段详细说明

### 1. region（区域）
- **类型**: `string`
- **说明**: 华为云区域名称
- **示例**: `"华北-北京四"`
- **用途**: 用于按区域筛选价格信息
- **注意**: 查询时支持区域映射，如"北京一"会自动映射到"北京四"

### 2. zone（可用区）注意: 不要把北京一这样的region放进zone中
- **类型**: `string`
- **说明**: 可用区名称，表示该区域下的具体可用区
- **示例**: `"通用可用区"`
- **用途**: 用于按可用区筛选价格信息

### 3. cpu_arch（CPU架构）
- **类型**: `string`
- **说明**: CPU 架构类型
- **示例**: `"X86计算"`
- **常见值**: 
  - `"X86计算"` - X86 架构
  - `"ARM计算"` - ARM 架构
- **用途**: 用于按 CPU 架构筛选价格信息

### 4. spec1（规格类型1）
- **类型**: `string`
- **说明**: 规格的大类分类，描述计算类型
- **示例**: `"通用计算增强型"`
- **常见值**:
  - `"通用计算增强型"`
  - `"内存优化型"`
  - `"计算优化型"`
  - `"GPU加速型"`
  - 等
- **用途**: 用于按规格大类筛选价格信息
- **查询支持**: 可通过 `spec` 字段同时匹配 `spec1` 和 `spec2`

### 5. spec2（规格类型2）
- **类型**: `string`
- **说明**: 具体的规格型号标识
- **示例**: `"Ac9s"`
- **用途**: 用于按具体规格型号筛选价格信息
- **查询支持**: 可通过 `spec` 字段同时匹配 `spec1` 和 `spec2`

### 6. image（镜像类型）
- **类型**: `string`
- **说明**: 操作系统镜像类型
- **示例**: `"Windows"`
- **常见值**:
  - `"Windows"` - Windows 操作系统
  - `"Linux"` - Linux 操作系统
  - `"CentOS"` - CentOS 系统
  - `"Ubuntu"` - Ubuntu 系统
  - 等
- **用途**: 用于按镜像类型筛选价格信息

### 7. price_table（价格表）
- **类型**: `object`
- **说明**: 包含价格表格的完整结构，包括表头和数据行

#### 7.1 headers（表头）
- **类型**: `array<string>`
- **说明**: 价格表格的列标题数组
- **示例**: `["规格名称", "核数", "内存", "按小时", "包月", "包1年", "包2年", "包3年", ""]`
- **列说明**:
  - `"规格名称"` - ECS 实例规格名称（如 `ac9s.large.2`）
  - `"核数"` - CPU 核心数（如 `"2核"`）
  - `"内存"` - 内存大小（如 `"4GiB"`）
  - `"按小时"` - 按小时计费价格（如 `"0.287 元"`）
  - `"包月"` - 包月价格（如 `"137.98 元"`）
  - `"包1年"` - 包1年价格（如 `"1,379.8 元"`）
  - `"包2年"` - 包2年价格（如 `"2,318.06 元"`）
  - `"包3年"` - 包3年价格（如 `"2,732 元"`）
  - 最后一个空字符串可能用于扩展列

#### 7.2 data（数据行）
- **类型**: `array<array<string>>`
- **说明**: 价格表格的数据行数组，每行对应一个规格的价格信息
- **格式**: 每行数据与 `headers` 数组一一对应
- **示例行**: `["ac9s.large.2", "2核", "4GiB", "0.287 元", "137.98 元", "1,379.8 元", "2,318.06 元", "2,732 元"]`
- **数据说明**:
  - 第一列：规格名称（如 `ac9s.large.2`）
  - 第二列：CPU 核数（如 `"2核"`）
  - 第三列：内存大小（如 `"4GiB"`）
  - 第四列及之后：各种计费方式的价格（包含货币单位，如 `"0.287 元"`）

### 8. created_at（创建时间）
- **类型**: `string`
- **说明**: 数据创建时间，采用 ISO 8601 格式
- **示例**: `"2025-11-21T12:53:24.580167"`
- **格式**: `YYYY-MM-DDTHH:MM:SS.ffffff`
- **用途**: 用于追踪数据的更新时间

## 数据示例

完整的数据记录示例：

```json
{
  "region": "华北-北京四",
  "zone": "通用可用区",
  "cpu_arch": "X86计算",
  "spec1": "通用计算增强型",
  "spec2": "Ac9s",
  "image": "Windows",
  "price_table": {
    "headers": ["规格名称", "核数", "内存", "按小时", "包月", "包1年", "包2年", "包3年", ""],
    "data": [
      ["ac9s.large.2", "2核", "4GiB", "0.287 元", "137.98 元", "1,379.8 元", "2,318.06 元", "2,732 元"],
      ["ac9s.large.4", "2核", "8GiB", "0.432 元", "207.57 元", "2,075.7 元", "3,487.18 元", "4,109.89 元"],
      ["ac9s.xlarge.2", "4核", "8GiB", "0.575 元", "275.95 元", "2,759.5 元", "4,635.96 元", "5,463.81 元"]
    ]
  },
  "created_at": "2025-11-21T12:53:24.580167"
}
```

## 查询结果格式

使用 `query_price` 工具查询时，返回的 JSON 格式如下：

```json
{
  "service": "ecs",
  "filters": {
    "region": "华北-北京四",
    "spec2": "Ac9s"
  },
  "data_filters": null,
  "pagination": {
    "page": 1,
    "page_size": 50,
    "total_count": 120,
    "total_pages": 3,
    "has_next": true,
    "has_prev": false
  },
  "count": 50,
  "results": [
    {
      "region": "华北-北京四",
      "zone": "通用可用区",
      "cpu_arch": "X86计算",
      "spec1": "通用计算增强型",
      "spec2": "Ac9s",
      "image": "Windows",
      "price_table": {
        "headers": ["规格名称", "核数", "内存", "按小时", "包月", "包1年", "包2年", "包3年", ""],
        "data": [
          ["ac9s.large.2", "2核", "4GiB", "0.287 元", "137.98 元", "1,379.8 元", "2,318.06 元", "2,732 元"]
        ]
      },
      "created_at": "2025-11-21T12:53:24.580167"
    }
  ]
}
```

### 分页信息说明

- `pagination.page`: 当前页码
- `pagination.page_size`: 每页记录数
- `pagination.total_count`: 符合条件的总记录数
- `pagination.total_pages`: 总页数
- `pagination.has_next`: 是否有下一页
- `pagination.has_prev`: 是否有上一页
- `count`: 当前页返回的记录数
- `results`: 当前页的价格数据列表

## 查询字段说明

MCP 工具在查询价格时，可以使用以下字段进行筛选（支持模糊匹配）：

| 字段名 | 说明 | 示例值 |
|--------|------|--------|
| `region` | 区域名称 | `"华北-北京四"` |
| `zone` | 可用区名称 | `"通用可用区"` |
| `cpu_arch` | CPU架构 | `"X86计算"` |
| `spec1` | 规格大类 | `"通用计算增强型"` |
| `spec2` | 规格型号 | `"Ac9s"` |
| `spec` | 规格（同时匹配 spec1 和 spec2） | `"Ac9s"` 或 `"通用计算增强型"` |
| `image` | 镜像类型 | `"Windows"` |

### 分页查询参数

当查询结果数量较多时，可以使用分页参数控制返回的数据量：

| 参数名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `page` | `int` | 页码，从1开始 | `1` |
| `page_size` | `int` | 每页记录数 | `50` |

**使用示例**：
- 查询第1页：`query_price(service="ecs", page=1, page_size=50)`
- 查询第2页：`query_price(service="ecs", page=2, page_size=50)`
- 自定义每页大小：`query_price(service="ecs", page=1, page_size=100)`

### 注意事项

1. **数组索引**: 数据行数组使用 0-based 索引，第一列（规格名称）的索引是 `[0]`
2. **数据类型**: 所有数据都是字符串类型，需要手动解析数值和单位
3. **空值处理**: 最后一列（索引 `[8]`）可能为空字符串，访问时需注意
4. **价格格式**: 价格字符串包含货币单位和千位分隔符，解析时需要清理
5. **数组长度**: 不同记录的数据行数量可能不同，遍历前应检查数组长度
6. **规格名称格式**: 规格名称遵循特定格式（如 `ac9s.large.2`），可用于模式匹配

## 使用场景

1. **价格查询**: 根据区域、规格、镜像等条件查询 ECS 实例价格
2. **价格对比**: 对比不同规格、不同计费方式的价格
3. **成本估算**: 根据业务需求估算云服务器成本
4. **规格推荐**: 根据预算和需求推荐合适的 ECS 规格
5. **分页浏览**: 当查询结果较多时，使用分页参数逐页浏览，提高查询效率

## 注意事项

1. **价格单位**: 所有价格字段都包含货币单位（"元"），解析时需要注意
2. **数据格式**: 价格数值可能包含千位分隔符（逗号），如 `"1,379.8 元"`
3. **区域映射**: 查询"北京一"时会自动映射到"北京四"
4. **模糊匹配**: 所有查询字段都支持模糊匹配（使用 `search` 方法）
5. **数据更新**: `created_at` 字段可用于判断数据的时效性
6. **空值处理**: `price_table.headers` 的最后一个元素可能为空字符串，解析时需注意
7. **分页查询**: 当查询结果较多时，建议使用分页参数（`page` 和 `page_size`）进行分页查询，默认每页50条记录
8. **页码验证**: 页码会自动验证和修正，小于1的页码会被修正为1，超过总页数的页码会被修正为最后一页
9. **分页信息**: 查询结果中的 `pagination` 对象提供了完整的分页信息，可用于判断是否有更多数据需要查询

## 数据存储

- **存储格式**: JSON 格式存储在 TinyDB 数据库中
- **数据库文件**: `ecs_price.json`
- **查询工具**: 使用 `query_price` 函数进行查询
- **返回格式**: 查询结果返回 JSON 格式字符串，包含：
  - 查询条件（`filters` 和 `data_filters`）
  - 分页信息（`pagination`）
  - 当前页的记录数量（`count`）
  - 当前页的价格数据列表（`results`）
- **分页支持**: 支持通过 `page` 和 `page_size` 参数进行分页查询，默认每页50条记录
