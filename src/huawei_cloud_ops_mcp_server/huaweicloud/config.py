from huawei_cloud_ops_mcp_server.huaweicloud.apidocs import SUPPORTED_SERVICES

XIAOHEI2018_PROJECT_ID = {
    '非洲-开罗': {
        'region': 'af-north-1',
        'project_id': 'fd83d445aa5b486e882506893bda6e04'
    },
    '非洲-约翰内斯堡': {
        'region': 'af-south-1',
        'project_id': 'da2f77ae9c2e4a80a1b54d9697e341e3'
    },
    '中国-香港': {
        'region': 'ap-southeast-1',
        'project_id': '1ff14256c93a4ce4a71f97861a19c67f'
    },
    '亚太-曼谷': {
        'region': 'ap-southeast-2',
        'project_id': '119c23bdbb45404090361532860195a2'
    },
    '亚太-新加坡': {
        'region': 'ap-southeast-3',
        'project_id': 'b91f7f7b97ad423b8b1594c877751ff8'
    },
    '亚太-雅加达': {
        'region': 'ap-southeast-4',
        'project_id': '7e1cb88367fa41d589447903a27a4069'
    },
    '亚太-马尼拉': {
        'region': 'ap-southeast-5',
        'project_id': 'a8243d342af44e728926cdd45b0d8f46'
    },
    '华东-上海二': {
        'region': 'cn-east-2',
        'project_id': 'b47f428e03da42f9acf17fbdaf65b4b3'
    },
    '华东-上海一': {
        'region': 'cn-east-3',
        'project_id': '05eb31eb5b0025df2fffc018710c5aa4'
    },
    '华东二': {
        'region': 'cn-east-4',
        'project_id': '18651faca4404dd0bdf286c1d1070c41'
    },
    '华东-青岛': {
        'region': 'cn-east-5',
        'project_id': '718fea843ceb4f53834152de31b818e2'
    },
    '华北-北京一': {
        'region': 'cn-north-1',
        'project_id': '96b3d3a55d184f23ace3d293a4105109'
    },
    '华北三': {
        'region': 'cn-north-12',
        'project_id': 'a0726ee3d6ab48ab927c1df7f9c02a51'
    },
    '华北-北京四': {
        'region': 'cn-north-4',
        'project_id': 'f033a60e8a8e496da41a890e0e013950'
    },
    '华北-乌兰察布一': {
        'region': 'cn-north-9',
        'project_id': '0d79ac54e100901b2fd6c018b1d626ee'
    },
    '华南-广州': {
        'region': 'cn-south-1',
        'project_id': '65305edb3fdc4db08426fe4d4e00a4ba'
    },
    '华南-广州-友好用户环境': {
        'region': 'cn-south-4',
        'project_id': '1fe377bf0ca84b7e822bc904406e6210'
    },
    '西南-贵阳一': {
        'region': 'cn-southwest-2',
        'project_id': 'db5d024bd0b14dc9ac58287019ccbd85'
    },
    '拉美-墨西哥城二': {
        'region': 'la-north-2',
        'project_id': 'ea822d97dda346cc93c18b6daedf4f72'
    },
    '拉美-圣地亚哥': {
        'region': 'la-south-2',
        'project_id': '0904c365dc80f34a2f01c0182d38eacf'
    },
    '中东-利雅得': {
        'region': 'me-east-1',
        'project_id': '3ab56bd3105b4552ab91ef1905a7f5ca'
    },
    '拉美-墨西哥城一': {
        'region': 'na-mexico-1',
        'project_id': '88ca6968ff8c4c8f808639de14549de3'
    },
    '拉美-圣保罗一': {
        'region': 'sa-brazil-1',
        'project_id': '0904c35e8580f5b62f40c0187ad1de8c'
    },
    '土耳其-伊斯坦布尔': {
        'region': 'tr-west-1',
        'project_id': '7fde4c3ebe6142d5995f041b93dd9c51'
    }
}

KRSK2021_PROJECT_ID = {
    '非洲-开罗': {
        'region': 'af-north-1',
        'project_id': 'a8eaf5a948fa4ecd8fb254afec009bf6'
    },
    '非洲-约翰内斯堡': {
        'region': 'af-south-1',
        'project_id': '0cc9c69e3a80f24320ac01455b50532'
    },
    '中国-香港': {
        'region': 'ap-southeast-1',
        'project_id': '0dd9150ea880942b2f1cc0149221f0b2b'
    },
    '亚太-曼谷': {
        'region': 'ap-southeast-2',
        'project_id': '0beee64114d00254c2f4cc014427abe52'
    },
    '亚太-新加坡': {
        'region': 'ap-southeast-3',
        'project_id': '0dd9150eef003f912f9ac014ad9ee0db'
    },
    '亚太-雅加达': {
        'region': 'ap-southeast-4',
        'project_id': '64a85f82d64c42c2b53988a8bb009eb9'
    },
    '亚太-马尼拉': {
        'region': 'ap-southeast-5',
        'project_id': 'bcf7dcbd1e64e88b0f2d9138ee9dbfb'
    },
    '华东-上海二': {
        'region': 'cn-east-2',
        'project_id': '0ca951016c80f4c42f45c01456c33ed5'
    },
    '华东-上海一': {
        'region': 'cn-east-3',
        'project_id': '0ba4fc4d1280f5e12f94c014d36b1fbc'
    },
    '华东二': {
        'region': 'cn-east-4',
        'project_id': '27de931af7124c0d94714cc1a8813dc'
    },
    '华东-青岛': {
        'region': 'cn-east-5',
        'project_id': '70ebd035a38a4208aad24d84733f2de0'
    },
    '华北-北京一': {
        'region': 'cn-north-1',
        'project_id': '0ba4fc4ec70025682f9ac014e8b7eced'
    },
    '华北三': {
        'region': 'cn-north-12',
        'project_id': '0963e6796384f759046b816e4469571'
    },
    '华北-北京四': {
        'region': 'cn-north-4',
        'project_id': '0bc65db6eaf0f2c12f90c014ed0d1d89'
    },
    '华北-乌兰察布一': {
        'region': 'cn-north-9',
        'project_id': '0d7b73bc8f00f4312f62c014f9c8a9e37'
    },
    '华南-广州': {
        'region': 'cn-south-1',
        'project_id': '0beeec4a9e80f2e52f97c014bc1817b2'
    },
    '华南-广州-友好用户环境': {
        'region': 'cn-south-4',
        'project_id': '0ddb8e677e80f4c12f1c014bba0f746'
    },
    '西南-贵阳一': {
        'region': 'cn-southwest-2',
        'project_id': '0d07fa91108f02b82f3cc01479f82c6a'
    },
    '拉美-墨西哥城二': {
        'region': 'la-north-2',
        'project_id': 'a42fb34fc1a048f1a45c2273e28e6e26'
    },
    '拉美-圣地亚哥': {
        'region': 'la-south-2',
        'project_id': '0dd9150f598f02c82d2b4c01466dde398'
    },
    '中东-利雅得': {
        'region': 'me-east-1',
        'project_id': 'ef10fa2a2eab4bd680068f4c39c31b87'
    },
    '拉美-墨西哥城一': {
        'region': 'na-mexico-1',
        'project_id': 'eeae328b13e943c8a61aeb9a46c04a61'
    },
    '拉美-圣保罗一': {
        'region': 'sa-brazil-1',
        'project_id': '3f5ba2c04414040a688c2a7fa28a557af'
    },
    '土耳其-伊斯坦布尔': {
        'region': 'tr-west-1',
        'project_id': '0d852916436d04955923be5ebd6f24898'
    }
}


def base_url(account: str, service: str, region: str) -> tuple[str, str, str]:
    '''
    获取华为云 API 基础 URL

    Args:
        account: 账号名称(如xiaohei2018,krsk2021)
        service: 服务类型(会自动转换为小写进行验证)
        region: 区域名称

    Returns:
        tuple[str, str, str]: (project_id, region, url)
    '''
    # 根据 account 参数选择对应的 PROJECT_ID 字典
    account_lower = account.lower()
    if account_lower == 'xiaohei2018':
        project_dict = XIAOHEI2018_PROJECT_ID
    elif account_lower == 'krsk2021':
        project_dict = KRSK2021_PROJECT_ID
    else:
        raise ValueError(
            f'错误: 不支持的账号 "{account}". '
            f'支持的账号: xiaohei2018, krsk2021'
        )

    # 同时获取项目的 region 和 project_id
    match = next(
        (v for k, v in project_dict.items() if region in k), None
    )

    if not match or 'project_id' not in match or 'region' not in match:
        raise ValueError(
            'project_id 或 region 参数未能从 region 信息中获取。请传入有效的华为云项目ID与区域。'
        )

    get_region = match['region']
    get_project_id = match['project_id']

    service_l = service.lower()
    if service_l not in SUPPORTED_SERVICES:
        supported_services = ', '.join(sorted(SUPPORTED_SERVICES))
        raise ValueError(
            f'错误: 不支持的服务类型 "{service}".'
            f'支持的服务: {supported_services}'
        )

    # 使用小写的服务名称构建 URL
    url = f'https://{service_l}.{get_region}.myhuaweicloud.com'
    return get_project_id, get_region, url
